---
layout:     post
title:      Implementing a Layer-2 Firewall using POX and Mininet 
date:       2017-10-19 16:34:00
summary:    Building on the concepts in the previous post to implement a L2 SDN Firewall in Mininet  
categories: networks
---

Hello there! Today we're going to see how to implement a Layer-2 SDN Firewall using the POX Controller and Mininet. We are also going to reuse the same *Tree* topology we created last time (albeit with some minor changes). In case you are new to Mininet, you are highly recommended to first go through the previous blog post on using Mininet, [here](http://www.anshuman.ml/networks/2017/10/15/mininet/)

Here is what you're going to learn today - 
- How to use the Python based POX OpenFlow controller instead of the default Mininet Controller 
- Understand what an SDN based Firewall does and implement it from scratch using POX

## Software Prerequisites
- **Mininet**: While you can use the Mininet VM like last time, I recommend installing the package if you're on Linux. For Ubuntu, just run:
`sudo apt-get install mininet` in terminal and you're good to go.
- **POX**: For the POX controller you just need to clone the git repository. I'm assuming you have git installed and know how to work it. If this is not the case, [this](http://rogerdudler.github.io/git-guide/) is a good resource. To clone the repository type the following in terminal and hit enter:
`git clone https://github.com/noxrepo/pox`

## SDN Firewall
A Firewall can be understood to be something that obstructs traffic coming its way and filters it according to some *rules*. A general Firewall can be employed to protect a network from the internet. For an SDN based Firewall, we are going to use the OpenFlow controller to filter traffic between hosts according to some rules and accordingly let it pass through or not.
The way we will do this is by using the POX controller to establish our required *policies* or *rules* (we will come to these later) and filter traffic between hosts using the switches.
An example of such an SDN Firewall with two hosts is shown in the figure below:
<div style="text-align:center" markdown="1">
![alt text](https://raw.githubusercontent.com/anshuman23/blog/master/images/firewallz.png)
</div>

## Implementation

# Mininet
The topology we are going to implement is going to be the same as last time. To recall, here is the diagram of the topology below - 
<div style="text-align:center" markdown="1">
![alt text](https://raw.githubusercontent.com/anshuman23/blog/master/images/tree.png)
</div>

Now, we can basically use the same file as last time, `tree.py` but with some modifications. These will basically be minor changes like referencing a remote controller instead of the default Mininet controller and specifying *simple* MAC addresses for our hosts so that we may reference them easily when we create rules for the Layer-2 Firewall. To recall, the code we were working with last time in `tree.py` was as follows:

{% highlight python %}
from mininet.net import Mininet
from mininet.node import Controller
from mininet.cli import CLI
from mininet.log import setLogLevel, info

def treeTopo():
    net = Mininet( controller=Controller )
    
    info( '*** Adding controller\n' )
    net.addController( 'c0' )

    info( '*** Adding hosts\n' )
    h1 = net.addHost( 'h1', ip='10.0.0.1' )
    h2 = net.addHost( 'h2', ip='10.0.0.2' )
    h3 = net.addHost( 'h3', ip='10.0.0.3' )
    h4 = net.addHost( 'h4', ip='10.0.0.4' )
    h5 = net.addHost( 'h5', ip='10.0.0.5' )
    h6 = net.addHost( 'h6', ip='10.0.0.6' )
    h7 = net.addHost( 'h7', ip='10.0.0.7' )
    h8 = net.addHost( 'h8', ip='10.0.0.8' )

    info( '*** Adding switches\n' )
    s1 = net.addSwitch( 's1' )
    s2 = net.addSwitch( 's2' )
    s3 = net.addSwitch( 's3' )
    s4 = net.addSwitch( 's4' )
    s5 = net.addSwitch( 's5' )
    s6 = net.addSwitch( 's6' )
    s7 = net.addSwitch( 's7' )

    info( '*** Creating links\n' )
    net.addLink( h1, s3 )
    net.addLink( h2, s3 )
    net.addLink( h3, s4 )
    net.addLink( h4, s4 )
    net.addLink( h5, s6 )
    net.addLink( h6, s6 )
    net.addLink( h7, s7 )
    net.addLink( h8, s7 )
    
    root = s1
    layer1 = [s2,s5]
    layer2 = [s3,s4,s6,s7]

    for idx,l1 in enumerate(layer1):
        net.addLink( root,l1 )
        net.addLink( l1, layer2[2*idx] )
        net.addLink( l1, layer2[2*idx + 1] )
        
    info( '*** Starting network\n')
    net.start()

    info( '*** Running CLI\n' )
    CLI( net )

    info( '*** Stopping network' )
    net.stop()

if __name__ == '__main__':
    setLogLevel( 'info' )
    treeTopo()
    
{% endhighlight %}

The changes we are going to make are just going to be two - 
1. Changing the controller to a remote one so we may use POX. We need to first import `RemoteController` instead of the regular `Controller` in our module import statements and then we can pass that through to the Mininet class. These changes are basically,
{% highlight python %}
from mininet.node import RemoteController
{% endhighlight%}
and,
{% highlight python %}
net = Mininet( controller=RemoteController )
{% endhighlight%}

