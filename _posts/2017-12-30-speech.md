---
layout:     post
title: Building a speech recognition agent using CMU Sphinx 
date:       2017-12-30 3:31:00
summary:    Using the CMU Sphinx/pocketsphinx speech recognition libraries to build a voice command recognition system   
categories: ml
---

Hello all! Firstly, I would like to apologize for this rather extended gap between posts. I have been busy with applications for graduate study and internships as part of the current curriculum. 

Getting down to business. Today we'll be looking at something interesting-- how to build our own voice command recognition system. This will entail:
1. Speak to your laptop to activate the agent
2. Only certain commands will activate the agent
3. When these commands are recognized, the agent can execute certain actions (This won't be covered here for obvious reasons-- feel free to create whatever you would like using these!)

The really good thing about what we're going to do today is that the reliance on external libraries is going to be minimal and is not going to require long and arduous code writing. At the end of it, we'll have a program capable of performing a seemingly complex task with supremely simple code (written in Python!).

### Deciding on the voice commands
We are going to have our program recognize the following commands:

- __HELLO__ : Saying __HELLO__ should generate a random templated response from a response list
- __DATE__ : Saying __DATE__ should give you the current system datetime
- __GOODBYE__ : Saying __GOODBYE__ should quit the program
- __NAME__ : Saying __NAME__ should display your name
- __SNAKE__ : Saying __SNAKE__ should start a game-- a Python program named `snake.py` (The script will be provided)

Feel free to have your own commands here. Now for Sphinx to recognize these commands internally, we are required to create a dictionary and a language model specifying them in a particular way. For this, we will use the [CMU Lexicon Tool](http://www.speech.cs.cmu.edu/tools/lmtool-new.html). 

### Generating the Language Model & Dictionary

Doing this is very simple. Just create a `words.txt` file with the following data:
```
HELLO
DATE
GOODBYE
NAME
SNAKE
```

Upload this file to the [CMU Lexicon Tool](http://www.speech.cs.cmu.edu/tools/lmtool-new.html) webpage. Download the `.dic` and `.lm` files from all the ones generated. In the current directory, place the `.dic` file in a directory called `dic` and the `.lm` file in a directory called `lm`.

We also need a pre-trained English model and we will be using the `en-us` model provided by CMU Sphinx itself. Download all the files present [here](https://github.com/cmusphinx/sphinx4/tree/master/sphinx4-data/src/main/resources/edu/cmu/sphinx/models/en-us/en-us) from Github and place them in the current directory in a folder `en-us` inside a folder called `model`. So in the current directory along with the `dic` and `lm` directories we now also have `model/en-us/` containing all the files previously downloaded from Github.

### Coding the voice assistant in Python

We first start off with our module imports:
{% highlight python %}
import sys
import os
import re
from subprocess import Popen
from time import sleep
{% endhighlight %}

Next we will add the locations of our dictionary and language model to our program:
{% highlight python %}
DIR_PATH = os.path.dirname(os.path.realpath(__file__))
DIC_PATH = DIR_PATH + "/dic/8455.dic"
LM_PATH = DIR_PATH + "/lm/8455.lm"
MODEL_PATH = DIR_PATH + "/model/en-us"
{% endhighlight %}

